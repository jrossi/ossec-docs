<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Agentless Monitoring &mdash; OSSEC</title>
    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/parallax.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.8.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="OSSEC" href="../../../index.html" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><img src="../../../_static/ossec_logo_bare_small.png">
          OSSEC</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../about.html">About <i class="fa fa-info-circle"></i></a></li>
                <li><a href="../../../blog.html">Blog <i class="fa fa-archive"></i></a></li>
                <li><a href="../../">Documentaton <i class="fa fa-book"></i></a></li>
                <li><a href="../../../downloads.html">Downloads <i class="fa fa-download"></i></a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="agentless-monitoring">
<span id="manual-agentless"></span><h1>Agentless Monitoring<a class="headerlink" href="#agentless-monitoring" title="Permalink to this headline">¶</a></h1>
<p><strong>Agentless monitoring</strong> allows you to run integrity checking
on systems without an agent installed (including routers, firewalls,
switches and even Linux/BSD systems). It can be executed just like our normal file
integrity checking (alerting of checksum changes) or doing diffs and showing
exactly what has changed.</p>
<div class="section" id="agentless-configuration-options">
<h2>Agentless configuration options<a class="headerlink" href="#agentless-configuration-options" title="Permalink to this headline">¶</a></h2>
<dl class="element">
<dt id="element-agentless">
<code class="descname">agentless</code><a class="headerlink" href="#element-agentless" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the section that will contain the agentless configuration.</p>
</dd></dl>

<dl class="element">
<dt id="element-frequency">
<code class="descname">frequency</code><a class="headerlink" href="#element-frequency" title="Permalink to this definition">¶</a></dt>
<dd><p>This controls the number of seconds between each run.</p>
</dd></dl>

<dl class="element">
<dt id="element-host">
<code class="descname">host</code><a class="headerlink" href="#element-host" title="Permalink to this definition">¶</a></dt>
<dd><p>This defines the username and agentless host.</p>
<p><strong>Example:</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;host&gt;root@linux.server.example.com&lt;/host&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="element">
<dt id="element-state">
<code class="descname">state</code><a class="headerlink" href="#element-state" title="Permalink to this definition">¶</a></dt>
<dd><p>This determines whether the checks are periodic or periodic_diff.</p>
<ul class="simple">
<li>periodic: The output from the scripts is processed by the OSSEC processes.</li>
<li>periodic_diff: The output from the scripts is compared to the output of previous runs.</li>
</ul>
</dd></dl>

<dl class="element">
<dt id="element-arguments">
<code class="descname">arguments</code><a class="headerlink" href="#element-arguments" title="Permalink to this definition">¶</a></dt>
<dd><p>This defines the arguments passed to the script.</p>
</dd></dl>

<p>Check <span class="xref std std-ref">_manual-agentless-scripts</span> for more information.</p>
</div>
<div class="section" id="getting-started-with-agentless">
<h2>Getting started with agentless<a class="headerlink" href="#getting-started-with-agentless" title="Permalink to this headline">¶</a></h2>
<p>After you installed OSSEC, you need to enable the agentless monitoring:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> /var/ossec/bin/ossec-control <span class="nb">enable </span>agentless
</pre></div>
</div>
<p>And provide the SSH authentication to the host you want to access. For Cisco devices
(PIX, routers, etc), you need to provide an additional parameter for the enable password.
The same thing applies if you want to add support for “su”, it must be the additional
parameter. In this example, I am adding a Linux box (example.net) and a PIX firewall
(pix.fw.local):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> /var/ossec/agentless/register_host.sh add root@example.net mypass1
<span class="go">  *Host root@example.netl added.</span>
<span class="gp">#</span> /var/ossec/agentless/register_host.sh add pix@pix.fw.local pixpass enablepass
<span class="go">  *Host pix@pix.fw.local added.</span>

<span class="gp">#</span> /var/ossec/agentless/register_host.sh list
<span class="go">  *Available hosts:</span>
<span class="go">pix@pix.fw.local</span>
<span class="go">root@example.net</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">register_host.sh</span></code> is a shell script, special characters may need to be escaped to not be interpreted by the shell.</p>
</div>
<p>If you want to use public key authentication instead of
passwords, you need to provide NOPASS as the password and
create the public key:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> sudo -u ossec ssh-keygen
</pre></div>
</div>
<p>It will create the public keys inside /var/ossec/.ssh .  After that, just scp the
public key to the remote box and your password less connection should work.</p>
</div>
<div class="section" id="configuring-agentless">
<h2>Configuring agentless<a class="headerlink" href="#configuring-agentless" title="Permalink to this headline">¶</a></h2>
<p>Once you have added all your systems, you need to configure
OSSEC to monitor them. By default, we have 4 agentless types
(but we plan to add more soon):</p>
<ul class="simple">
<li>ssh_integrity_check_bsd</li>
<li>ssh_integrity_check_linux</li>
<li>ssh_generic_diff</li>
<li>ssh_pixconfig_diff</li>
</ul>
<p>For the first two, you give a list of directories in the configuration and OSSEC
will do the integrity checking of them on the remote box. On the
ssh_generic_diff, you give a set of commands to run on the remote box and OSSEC
will alert when the output of them changes. The ssh_pixconfig_diff will alert
when a Cisco PIX/router configuration changes.</p>
<p>So, for my first system (<a class="reference external" href="mailto:root&#37;&#52;&#48;example&#46;net">root<span>&#64;</span>example<span>&#46;</span>net</a>), I will monitor the /bin, /etc and /sbin
directories every 10 hours (if I was using the ssh_integrity_check_bsd, the
argument would be the directories as well):</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;agentless&gt;</span>
    <span class="nt">&lt;type&gt;</span>ssh_integrity_check_linux<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;frequency&gt;</span>36000<span class="nt">&lt;/frequency&gt;</span>
    <span class="nt">&lt;host&gt;</span>root@example.net<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;state&gt;</span>periodic<span class="nt">&lt;/state&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>/bin /etc/ /sbin<span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/agentless&gt;</span>
</pre></div>
</div>
<p>For my PIX, the configuration looks like:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;agentless&gt;</span>
    <span class="nt">&lt;type&gt;</span>ssh_pixconfig_diff<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;frequency&gt;</span>36000<span class="nt">&lt;/frequency&gt;</span>
    <span class="nt">&lt;host&gt;</span>pix@pix.fw.local<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;state&gt;</span>periodic_diff<span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/agentless&gt;</span>
</pre></div>
</div>
<p>And just to exemplify the ssh_generic_diff I will also monitor ls -la /etc; cat
/etc/passwd on the <a class="reference external" href="mailto:root&#37;&#52;&#48;example&#46;net">root<span>&#64;</span>example<span>&#46;</span>net</a>. Note that if you want to monitor any network
firewall or switch, you can use the ssh_generic_diff and just specify the
commands in the arguments option. To use “su”, you need to set the value
“use_su” before the hostname (eg: &lt;host&gt;use_su <a class="reference external" href="mailto:root&#37;&#52;&#48;example">root<span>&#64;</span>example</a>.net&lt;/host&gt;).</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;agentless&gt;</span>
    <span class="nt">&lt;type&gt;</span>ssh_generic_diff<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;frequency&gt;</span>36000<span class="nt">&lt;/frequency&gt;</span>
    <span class="nt">&lt;host&gt;</span>root@example.net<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;state&gt;</span>periodic_diff<span class="nt">&lt;/state&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>ls -la /etc; cat /etc/passwd<span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/agentless&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-completed-setup">
<h2>Running the completed setup<a class="headerlink" href="#running-the-completed-setup" title="Permalink to this headline">¶</a></h2>
<p>Once the configuration is completed, you can restart OSSEC. You should see
something like “Started ossec-agentlessd” in the output. Before each agentless
connection is started, OSSEC will do a configuration check to make sure
everything is fine. Look at /var/ossec/logs/ossec.log for any error. If you see:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">2008/12/12 15:20:06 ossec-agentlessd: ERROR: Expect command not found (or bad arguments) for &#39;ssh_integrity_check_bsd&#39;.</span>
<span class="go">2008/12/12 15:20:06 ossec-agentlessd: ERROR: Test failed for &#39;ssh_integrity_check_bsd&#39; (127). Ignoring.&#39;</span>
</pre></div>
</div>
<p>It means that you don’t have the expect library installed on the server (it is
not necessary to install anything on the agentless systems to monitor). On
Ubuntu you can do the following to install:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> apt-get install expect
</pre></div>
</div>
<p>After installing expect, you can restart OSSEC and you should see:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">2008/12/12 15:24:12 ossec-agentlessd: INFO: Test passed for &#39;ssh_integrity_check_bsd&#39;.&#39;</span>
</pre></div>
</div>
<p>When it connects to the remote system, you will also see:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">2008/12/12 15:25:19 ossec-agentlessd: INFO: ssh_integrity_check_bsd: root@example.net: Starting.</span>
<span class="go">2008/12/12 15:25:46 ossec-agentlessd: INFO: ssh_integrity_check_bsd: root@example.net: Finished.</span>
</pre></div>
</div>
</div>
<div class="section" id="alerts">
<h2>Alerts<a class="headerlink" href="#alerts" title="Permalink to this headline">¶</a></h2>
<p>These are some of the alerts you will get:</p>
<p>For the ssh_generic_diff:</p>
<div class="highlight-python"><div class="highlight"><pre>OSSEC HIDS Notification.
2008 Dec 12 01:58:30

Received From: (ssh_generic_diff) root@example.net-&gt;agentless
Rule: 555 fired (level 7) -&gt; &quot;Integrity checksum for agentless device changed.&quot;
Portion of the log(s):

ossec: agentless: Change detected:
35c35
&lt; -rw-r-r- 1 root wheel 34 Dec 10 03:55 hosts.deny
--
&gt; -rw-r-r- 1 root wheel 34 Dec 11 18:23 hosts.deny
-END OF NOTIFICATION
</pre></div>
</div>
<p>For the PIX:</p>
<div class="highlight-python"><div class="highlight"><pre>OSSEC HIDS Notification.
2008 Dec 01 15:48:03

Received From: (ssh_pixconfig_diff) pix@pix.fw.local-&gt;agentless
Rule: 555 fired (level 7) -&gt; &quot;Integrity checksum for agentless device changed.&quot;
Portion of the log(s):

ossec: agentless: Change detected:
48c48
&lt; fixup protocol ftp 21
--
&gt; no fixup protocol ftp 21
100c100
&lt; ssh timeout 30
--
&gt; ssh timeout 50
More changes..

-END OF NOTIFICATION
</pre></div>
</div>
</div>
</div>

  <div class="section">
  
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2015, OSSEC Project Team - OSSEC trademark and domain owned by Trend Micro, Inc. - Home page images courtesy of Pixbay.com.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>